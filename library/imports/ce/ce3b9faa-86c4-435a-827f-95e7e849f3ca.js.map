{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Game.js"],"names":["Bird","require","cc","Class","extends","Component","properties","pipeUp","default","type","Prefab","pipeDown","bird","ground","Node","pipePrefabs","menuBtn","againBtn","Score","ScoreLabel","Label","overBoard","scoreBoard","bestScore","moneyScore","pipeMaxInterval","pipeMinInterval","pipeDistance","spawnNewPipe","newPipUp","instantiate","newPipDown","mark","randY","random0To1","node","height","pipes","push","pipCount","setPosition","setPipePosition","insertChild","dire","PosX","PosY","pipeInterval","pipeHeight","sceneWidth","p","onLoad","self","opacity","data","pipeWidth","width","sceneHeight","birdHeight","score","string","toString","money","over","director","preloadScene","portrar","sys","localStorage","getItem","birdAnim","getComponent","Animation","play","on","mapNum","loadScene","schedule","gameOver","parseInt","Math","floor","arr","split","unschedule","eventManager","removeListener","touchListener","overAnim","againAnim","menuAnim","i","splice","length","pop","setItem","update","dt","index","x","removeChild","shift","gainScore","collision","y"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Bird = require('Bird');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        //管道对象\r\n        pipeUp: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        pipeDown: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        //小鸟对象\r\n        bird: {\r\n            default: null,\r\n            type: Bird\r\n        },\r\n\r\n        //地板对象\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        //管道数组\r\n        pipePrefabs: {\r\n            default: [],\r\n            type: [cc.Prefab]\r\n        },\r\n\r\n        //菜单的按钮\r\n        menuBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        againBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        Score: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        ScoreLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        overBoard: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        scoreBoard: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        //最高分数对象\r\n        bestScore: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        //金币对象\r\n        moneyScore: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        pipeMaxInterval: 0, //管道的最大间距\r\n        pipeMinInterval: 0, //管道的最小间距\r\n        pipeDistance: 0, //一对管道之间的距离\r\n\r\n    },\r\n\r\n    //生成管道\r\n    spawnNewPipe: function () {\r\n        //生成两个新的管道对象\r\n        var newPipUp = cc.instantiate(this.pipePrefabs[0]);\r\n        var newPipDown = cc.instantiate(this.pipePrefabs[1]);\r\n\r\n        //添加标识\r\n        newPipDown.mark = true;\r\n\r\n        //生成一个管道的y轴随机数\r\n        var randY = cc.random0To1() * (this.node.height / 2);\r\n\r\n        //将生成的管道放入数组\r\n        this.pipes.push(newPipUp);\r\n        this.pipes.push(newPipDown);\r\n\r\n        //管道的对数加一\r\n        this.pipCount++;\r\n\r\n        //设置出现的位置\r\n        newPipUp.setPosition(this.setPipePosition(1, randY));\r\n        newPipDown.setPosition(this.setPipePosition(0, randY));\r\n\r\n        //添加到游戏中\r\n        this.node.insertChild(newPipUp, 1);\r\n        this.node.insertChild(newPipDown, 1);\r\n\r\n\r\n\r\n    },\r\n\r\n    //设置管道位置\r\n    setPipePosition: function (dire, randY) {\r\n        var PosX = 0;\r\n        var PosY = 0;\r\n\r\n        //随机生成上下管道的间距\r\n        var pipeInterval = (cc.random0To1() * (this.pipeMaxInterval - this.pipeMinInterval)) + this.pipeMinInterval;\r\n\r\n        if (dire) {\r\n            //下边的管道\r\n            PosY = -randY;\r\n        } else {\r\n            //上边的管道\r\n            PosY = this.pipeHeight - randY + pipeInterval;\r\n        }\r\n\r\n        PosX = this.pipeDistance + this.sceneWidth;\r\n\r\n        return cc.p(PosX, PosY);\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n\r\n        var self = this;\r\n\r\n        self.Score.opacity = 200;\r\n        //管道的高度\r\n        this.pipeHeight = this.pipeUp.data.height;\r\n        //获取管道的宽度\r\n        this.pipeWidth = this.pipeUp.data.width;\r\n        //获取屏幕一半的宽度\r\n        this.sceneWidth = this.node.width / 2;\r\n        //获取屏幕一半的高度\r\n        this.sceneHeight = this.node.height / 2;\r\n        //管道的对数\r\n        this.pipCount = 0;\r\n        //数组初始化\r\n        this.pipes = [];\r\n        //小鸟的高度\r\n        this.birdHeight = this.bird.node.height;\r\n        //分数\r\n        this.score = 0;\r\n        this.ScoreLabel.string = 'score: ' + this.score.toString();\r\n        //金钱\r\n        this.money = 0;\r\n        //判断是否结束\r\n        this.over = false;\r\n        //预加载返回到开始界面的场景\r\n        cc.director.preloadScene('start');\r\n\r\n        //获取主角的动画对象\r\n        \r\n        let portrar = cc.sys.localStorage.getItem('portrartNum');\r\n        portrar ? portrar : portrar = 0;\r\n     \r\n             //获取主角的动画对象\r\n        var birdAnim = this.bird.getComponent(cc.Animation);\r\n     \r\n             //根据获取到的主角编号执行对应的动画\r\n        switch (portrar) {\r\n            case '1':\r\n                birdAnim.play('bird_blue');\r\n                break;\r\n            case '2':\r\n                birdAnim.play('bird_red');\r\n                break;\r\n            case '3':\r\n                birdAnim.play('bird_yellow');\r\n                break;\r\n            case '4':\r\n                birdAnim.play('bird_new');\r\n                break;\r\n            case '5':\r\n                birdAnim.play('bird_dragon');\r\n                break;\r\n            default:\r\n                birdAnim.play('bird_monster');\r\n                break;\r\n        }\r\n            \r\n        \r\n        this.againBtn.on('touchstart', function () {\r\n            //重新开始游戏\r\n            this.mapNum = cc.sys.localStorage.getItem(\"mapNum\")\r\n            if (this.mapNum == 1)\r\n                cc.director.loadScene('game1');\r\n            else if (this.mapNum == 2)\r\n                cc.director.loadScene('game2');\r\n        });\r\n\r\n        this.menuBtn.on('touchstart', function () {\r\n            //返回主界面\r\n            cc.director.loadScene('start');\r\n        });\r\n\r\n\r\n        //定时生成管道\r\n        this.schedule(this.spawnNewPipe, 3);\r\n\r\n    },\r\n\r\n\r\n    gameOver: function () {\r\n\r\n        //获取以前的金钱数量\r\n        var money = parseInt(cc.sys.localStorage.getItem('money'));\r\n        //获取最高分\r\n        var bestScore = cc.sys.localStorage.getItem('bestScore');\r\n        this.Score.opacity = 0;\r\n        //计算本次结束的金钱数量\r\n        this.money = Math.floor(this.score / 10);\r\n        money ? money += this.money : money = this.money;\r\n        //获取排行榜的数组\r\n        var arr = cc.sys.localStorage.getItem('arr');\r\n        arr ? arr = arr.split(','):arr = [];\r\n\r\n        bestScore = bestScore || 0;\r\n        //停止定时器\r\n        this.unschedule(this.spawnNewPipe, this);\r\n        //初始化数组\r\n        this.pipes = [];\r\n        //取消事件绑定\r\n        cc.eventManager.removeListener(this.bird.touchListener);\r\n        //显示分数\r\n        this.scoreBoard.string = this.score;\r\n        //显示金币数\r\n        this.moneyScore.string = this.money;\r\n        //显示最高分\r\n        this.bestScore.string = bestScore;\r\n\r\n        //播放动画事件\r\n        var overAnim = this.overBoard.getComponent(cc.Animation);\r\n        var againAnim = this.againBtn.getComponent(cc.Animation);\r\n        var menuAnim = this.menuBtn.getComponent(cc.Animation);\r\n\r\n        overAnim.play('overBoard');\r\n        againAnim.play('button_move3');\r\n        menuAnim.play('button_move2');\r\n\r\n        for (var i = 0; i < 5; i++) {\r\n            arr[i] = arr[i] || 0;\r\n\r\n            //判断当前分数是否大于排行榜里的任意值\r\n            if (this.score > arr[i]) {\r\n\r\n                arr.splice(i, 0, this.score);\r\n\r\n                //判断数组的长度大于5就删除数组的最后一位\r\n                if (arr.length > 5) {\r\n                    arr.pop();\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        \r\n\r\n        //储存金钱数量\r\n        cc.sys.localStorage.setItem('money', Math.floor(money));\r\n        //储存排行榜数量\r\n        cc.sys.localStorage.setItem('arr', arr.toString());\r\n\r\n        if (bestScore) {\r\n            //判断当前分数是否大于最高分\r\n            if (bestScore < this.score) {\r\n                //存储最高分数\r\n                cc.sys.localStorage.setItem('bestScore', this.score);\r\n            }\r\n        } else {\r\n            cc.sys.localStorage.setItem('bestScore', this.score);\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n\r\n        for (var index = 0; index < this.pipes.length; index++) {\r\n            this.pipes[index].x -= 1;\r\n\r\n            //超出屏幕范围清除元素\r\n            if (this.pipes[index].x < -(this.pipeWidth + this.sceneWidth)) {\r\n                this.node.removeChild(this.pipes[index]);\r\n                this.pipes.shift();\r\n            }\r\n\r\n            //判断小鸟是否穿过管道\r\n            if (this.bird.node.x > this.pipes[index].x && this.pipes[index].mark) {\r\n                this.pipes[index].mark = false;\r\n                this.gainScore();\r\n            }\r\n\r\n            //判断小鸟是否碰撞到管道上\r\n            if (this.bird.collision) {\r\n                this.over = true;\r\n                this.gameOver();\r\n            }\r\n\r\n        }\r\n\r\n        //判断小鸟是否超出屏幕以及接触地面\r\n        if ((this.bird.node.y > this.sceneHeight ||\r\n            this.bird.node.y < this.ground.y) &&\r\n            !this.over) {\r\n            this.over = true;\r\n            this.gameOver();\r\n        }\r\n\r\n\r\n    },\r\n    gainScore: function () {\r\n\r\n        this.score += 1;\r\n\r\n        this.ScoreLabel.string = 'score: ' + this.score.toString();\r\n    }\r\n});\r\n"]}