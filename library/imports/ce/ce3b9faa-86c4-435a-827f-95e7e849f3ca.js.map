{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Game.js"],"names":["Bird","require","cc","Class","extends","Component","properties","pipeUp","default","type","Prefab","pipeDown","bird","ground","Node","pipePrefabs","menuBtn","againBtn","Score","ScoreLabel","Label","overBoard","scoreBoard","bestScore","moneyScore","pipeMaxInterval","pipeMinInterval","pipeDistance","spawnNewPipe","newPipUp","instantiate","newPipDown","mark","randY","random0To1","node","height","pipes","push","pipCount","setPosition","setPipePosition","insertChild","dire","PosX","PosY","pipeInterval","pipeHeight","sceneWidth","p","onLoad","self","opacity","data","pipeWidth","width","sceneHeight","birdHeight","score","string","toString","money","over","director","preloadScene","birdAnim","getComponent","Animation","play","on","mapNum","sys","localStorage","getItem","loadScene","schedule","gameOver","parseInt","Math","floor","unschedule","eventManager","removeListener","touchListener","overAnim","againAnim","menuAnim","setItem","update","dt","index","length","x","removeChild","shift","gainScore","collision","y"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Bird = require('Bird');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        //管道对象\r\n        pipeUp: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        pipeDown: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        //小鸟对象\r\n        bird: {\r\n            default: null,\r\n            type: Bird\r\n        },\r\n\r\n        //地板对象\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        //管道数组\r\n        pipePrefabs: {\r\n            default: [],\r\n            type: [cc.Prefab]\r\n        },\r\n\r\n        //菜单的按钮\r\n        menuBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        againBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        Score: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        ScoreLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        overBoard: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        scoreBoard: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        //最高分数对象\r\n        bestScore: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        //金币对象\r\n        moneyScore: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        pipeMaxInterval: 0, //管道的最大间距\r\n        pipeMinInterval: 0, //管道的最小间距\r\n        pipeDistance: 0, //一对管道之间的距离\r\n\r\n    },\r\n\r\n    //生成管道\r\n    spawnNewPipe: function () {\r\n        //生成两个新的管道对象\r\n        var newPipUp = cc.instantiate(this.pipePrefabs[0]);\r\n        var newPipDown = cc.instantiate(this.pipePrefabs[1]);\r\n\r\n        //添加标识\r\n        newPipDown.mark = true;\r\n\r\n        //生成一个管道的y轴随机数\r\n        var randY = cc.random0To1() * (this.node.height / 2);\r\n\r\n        //将生成的管道放入数组\r\n        this.pipes.push(newPipUp);\r\n        this.pipes.push(newPipDown);\r\n\r\n        //管道的对数加一\r\n        this.pipCount++;\r\n\r\n        //设置出现的位置\r\n        newPipUp.setPosition(this.setPipePosition(1, randY));\r\n        newPipDown.setPosition(this.setPipePosition(0, randY));\r\n\r\n        //添加到游戏中\r\n        this.node.insertChild(newPipUp, 1);\r\n        this.node.insertChild(newPipDown, 1);\r\n\r\n\r\n\r\n    },\r\n\r\n    //设置管道位置\r\n    setPipePosition: function (dire, randY) {\r\n        var PosX = 0;\r\n        var PosY = 0;\r\n\r\n        //随机生成上下管道的间距\r\n        var pipeInterval = (cc.random0To1() * (this.pipeMaxInterval - this.pipeMinInterval)) + this.pipeMinInterval;\r\n\r\n        if (dire) {\r\n            //下边的管道\r\n            PosY = -randY;\r\n        } else {\r\n            //上边的管道\r\n            PosY = this.pipeHeight - randY + pipeInterval;\r\n        }\r\n\r\n        PosX = this.pipeDistance + this.sceneWidth;\r\n\r\n        return cc.p(PosX, PosY);\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n\r\n        var self = this;\r\n\r\n        self.Score.opacity = 200;\r\n        //管道的高度\r\n        this.pipeHeight = this.pipeUp.data.height;\r\n        //获取管道的宽度\r\n        this.pipeWidth = this.pipeUp.data.width;\r\n        //获取屏幕一半的宽度\r\n        this.sceneWidth = this.node.width / 2;\r\n        //获取屏幕一半的高度\r\n        this.sceneHeight = this.node.height / 2;\r\n        //管道的对数\r\n        this.pipCount = 0;\r\n        //数组初始化\r\n        this.pipes = [];\r\n        //小鸟的高度\r\n        this.birdHeight = this.bird.node.height;\r\n        //分数\r\n        this.score = 0;\r\n        this.ScoreLabel.string = 'score: ' + this.score.toString();\r\n        //金钱\r\n        this.money = 0;\r\n        //判断是否结束\r\n        this.over = false;\r\n        //预加载返回到开始界面的场景\r\n        cc.director.preloadScene('start');\r\n\r\n        //获取主角的动画对象\r\n        var birdAnim = this.bird.getComponent(cc.Animation);\r\n\r\n\r\n        birdAnim.play('bird_blue');\r\n\r\n\r\n        this.againBtn.on('touchstart', function () {\r\n            //重新开始游戏\r\n            this.mapNum = cc.sys.localStorage.getItem(\"mapNum\")\r\n            if(this.mapNum==1)\r\n            cc.director.loadScene('game1');\r\n            else if(this.mapNum==2)\r\n            cc.director.loadScene('game2');\r\n        });\r\n\r\n        this.menuBtn.on('touchstart', function () {\r\n            //返回主界面\r\n            cc.director.loadScene('start');\r\n        });\r\n\r\n\r\n        //定时生成管道\r\n        this.schedule(this.spawnNewPipe, 3);\r\n\r\n    },\r\n\r\n\r\n    gameOver: function () {\r\n\r\n        //获取以前的金钱数量\r\n        var money = parseInt(cc.sys.localStorage.getItem('money'));\r\n        //获取最高分\r\n        var bestScore = cc.sys.localStorage.getItem('bestScore');\r\n        this.Score.opacity = 0;\r\n        //计算本次结束的金钱数量\r\n        this.money = Math.floor(this.score / 10);\r\n\r\n        money ? money += this.money : money = this.money;\r\n        bestScore = bestScore || 0;\r\n        //停止定时器\r\n        this.unschedule(this.spawnNewPipe, this);\r\n        //初始化数组\r\n        this.pipes = [];\r\n        //取消事件绑定\r\n        cc.eventManager.removeListener(this.bird.touchListener);\r\n        //显示分数\r\n        this.scoreBoard.string = this.score;\r\n        //显示金币数\r\n        this.moneyScore.string = this.money;\r\n        //显示最高分\r\n        this.bestScore.string = bestScore;\r\n\r\n        //播放动画事件\r\n        var overAnim = this.overBoard.getComponent(cc.Animation);\r\n        var againAnim = this.againBtn.getComponent(cc.Animation);\r\n        var menuAnim = this.menuBtn.getComponent(cc.Animation);\r\n\r\n        overAnim.play('overBoard');\r\n        againAnim.play('button_move3');\r\n        menuAnim.play('button_move2');\r\n\r\n        //储存金钱数量\r\n        cc.sys.localStorage.setItem('money', Math.floor(money));\r\n\r\n        if (bestScore) {\r\n            //判断当前分数是否大于最高分\r\n            if (bestScore < this.score) {\r\n                //存储最高分数\r\n                cc.sys.localStorage.setItem('bestScore', this.score);\r\n            }\r\n        } else {\r\n            cc.sys.localStorage.setItem('bestScore', this.score);\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n\r\n        for (var index = 0; index < this.pipes.length; index++) {\r\n            this.pipes[index].x -= 1;\r\n\r\n            //超出屏幕范围清除元素\r\n            if (this.pipes[index].x < -(this.pipeWidth + this.sceneWidth)) {\r\n                this.node.removeChild(this.pipes[index]);\r\n                this.pipes.shift();\r\n            }\r\n\r\n            //判断小鸟是否穿过管道\r\n            if (this.bird.node.x > this.pipes[index].x && this.pipes[index].mark) {\r\n                this.pipes[index].mark = false;\r\n                this.gainScore();\r\n            }\r\n\r\n            //判断小鸟是否碰撞到管道上\r\n            if (this.bird.collision) {\r\n                this.over = true;\r\n                this.gameOver();\r\n            }\r\n\r\n        }\r\n\r\n        //判断小鸟是否超出屏幕以及接触地面\r\n        if ((this.bird.node.y > this.sceneHeight ||\r\n            this.bird.node.y < this.ground.y) &&\r\n            !this.over) {\r\n            this.over = true;\r\n            this.gameOver();\r\n        }\r\n\r\n\r\n    },\r\n    gainScore: function () {\r\n\r\n        this.score += 1;\r\n\r\n        this.ScoreLabel.string = 'score: ' + this.score.toString();\r\n    }\r\n});\r\n"]}