{"version":3,"sources":["Game.js"],"names":["Bird","require","cc","Class","extends","Component","properties","pipeUp","default","type","Prefab","pipeDown","dieAudio","url","AudioClip","pressAudio","backgroundAudio","readygoAudio","bird","ground","Node","pipePrefabs","menuBtn","againBtn","Score","ScoreLabel","Label","overBoard","scoreBoard","bestScore","moneyScore","pipeMaxInterval","pipeMinInterval","pipeDistance","spawnNewPipe","newPipUp","instantiate","newPipDown","mark","randY","random0To1","node","height","pipes","push","pipCount","setPosition","setPipePosition","insertChild","dire","PosX","PosY","pipeInterval","pipeHeight","sceneWidth","p","play","onLoad","self","opacity","data","pipeWidth","width","sceneHeight","birdHeight","score","string","toString","money","over","director","preloadScene","audioEngine","birdAnim","getComponent","Animation","id1","on","pause","mapNum","sys","localStorage","getItem","loadScene","schedule","gameOver","parseInt","Math","floor","arr","split","unschedule","eventManager","removeListener","touchListener","overAnim","againAnim","menuAnim","i","splice","length","pop","setItem","update","dt","index","x","removeChild","shift","collision","gainScore","y"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Bird = require('Bird');\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        //管道对象\r\n        pipeUp: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        pipeDown: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        dieAudio:\r\n        {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        pressAudio:\r\n        {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        backgroundAudio:\r\n        {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        readygoAudio:\r\n        {\r\n            default: null,\r\n            url: cc.AudioClip\r\n        },\r\n        //小鸟对象\r\n        bird: {\r\n            default: null,\r\n            type: Bird\r\n        },\r\n\r\n        //地板对象\r\n        ground: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        //管道数组\r\n        pipePrefabs: {\r\n            default: [],\r\n            type: [cc.Prefab]\r\n        },\r\n\r\n        //菜单的按钮\r\n        menuBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        againBtn: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        Score: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n\r\n        ScoreLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        overBoard: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        scoreBoard: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        //最高分数对象\r\n        bestScore: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        //金币对象\r\n        moneyScore: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        pipeMaxInterval: 0, //管道的最大间距\r\n        pipeMinInterval: 0, //管道的最小间距\r\n        pipeDistance: 0, //一对管道之间的距离\r\n\r\n    },\r\n\r\n    //生成管道\r\n    spawnNewPipe: function () {\r\n        //生成两个新的管道对象\r\n        let newPipUp = cc.instantiate(this.pipePrefabs[0]);\r\n        let newPipDown = cc.instantiate(this.pipePrefabs[1]);\r\n\r\n        //添加标识\r\n        newPipDown.mark = true;\r\n\r\n        //生成一个管道的y轴随机数\r\n        let randY = cc.random0To1() * (this.node.height / 2);\r\n\r\n        //将生成的管道放入数组\r\n        this.pipes.push(newPipUp);\r\n        this.pipes.push(newPipDown);\r\n\r\n        //管道的对数加一\r\n        this.pipCount++;\r\n\r\n        //设置出现的位置\r\n        newPipUp.setPosition(this.setPipePosition(1, randY));\r\n        newPipDown.setPosition(this.setPipePosition(0, randY));\r\n\r\n        //添加到游戏中\r\n        this.node.insertChild(newPipUp, 1);\r\n        this.node.insertChild(newPipDown, 1);\r\n    },\r\n\r\n    //设置管道位置\r\n    setPipePosition: function (dire, randY) {\r\n        let PosX = 0;\r\n        let PosY = 0;\r\n        //随机生成上下管道的间距\r\n        let pipeInterval = (cc.random0To1() * (this.pipeMaxInterval - this.pipeMinInterval)) + this.pipeMinInterval;\r\n        if (dire) {\r\n            //下边的管道\r\n            PosY = -randY;\r\n        } else {\r\n            //上边的管道\r\n            PosY = this.pipeHeight - randY + pipeInterval;\r\n        }\r\n        PosX = this.pipeDistance + this.sceneWidth;\r\n\r\n        return cc.p(PosX, PosY);\r\n    },\r\n\r\n    play: function () {\r\n        this.backgroundAudio.play();\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        let self = this;\r\n\r\n        self.Score.opacity = 200;\r\n        this.pipeHeight = this.pipeUp.data.height;\r\n        this.pipeWidth = this.pipeUp.data.width;\r\n        this.sceneWidth = this.node.width / 2;\r\n        this.sceneHeight = this.node.height / 2;\r\n        //管道初始化\r\n        this.pipCount = 0;\r\n        this.pipes = [];\r\n\r\n        this.birdHeight = this.bird.node.height;\r\n        //分数\r\n        this.score = 0;\r\n        this.ScoreLabel.string = 'score: ' + this.score.toString();\r\n        //金钱\r\n        this.money = 0;\r\n        //判断是否结束\r\n        this.over = false;\r\n        //预加载\r\n        cc.director.preloadScene('start');\r\n\r\n        cc.audioEngine.play(self.readygoAudio, false, 1);\r\n        //获取主角的动画对象\r\n        let birdAnim = this.bird.getComponent(cc.Animation);\r\n        birdAnim.play('bird_blue');\r\n        //cc.audioEngine.stop(self.readygoAudio);\r\n        let id1 = cc.audioEngine.play(self.backgroundAudio, true, 1);\r\n\r\n        this.againBtn.on('touchstart', function () {\r\n            //重新开始游戏\r\n            cc.audioEngine.play(self.pressAudio, false, 1);\r\n            cc.audioEngine.pause(id1);\r\n            //this.backgroundAudio.play();\r\n            this.mapNum = cc.sys.localStorage.getItem(\"mapNum\")\r\n            if (this.mapNum == 1) {\r\n                cc.director.loadScene('game1');\r\n            }\r\n\r\n            else if (this.mapNum == 2) {\r\n                cc.director.loadScene('game2');\r\n            }\r\n            //cc.audioEngine.play(self.backgroundAudio, true, 1 );   \r\n        });\r\n\r\n        this.menuBtn.on('touchstart', function () {\r\n            //返回主界面\r\n            cc.audioEngine.pause(id1);\r\n            cc.audioEngine.play(self.pressAudio, false, 1);\r\n\r\n            cc.director.loadScene('start');\r\n        });\r\n        //定时生成管道\r\n        this.schedule(this.spawnNewPipe, 3);\r\n\r\n    },\r\n\r\n    gameOver: function () {\r\n\r\n        //cc.audioEngine.pause(this.backgroundAudio); \r\n        let money = parseInt(cc.sys.localStorage.getItem('money'));\r\n        let bestScore = cc.sys.localStorage.getItem('bestScore');\r\n        this.Score.opacity = 0;\r\n        //计算本次结束的金钱数量\r\n        this.money = Math.floor(this.score / 10);\r\n        money ? money += this.money : money = this.money;\r\n        //获取排行榜的数组\r\n        let arr = cc.sys.localStorage.getItem('arr');\r\n        arr ? arr = arr.split(',') : arr = [];\r\n\r\n        bestScore = bestScore || 0;\r\n        //停止定时器\r\n        this.unschedule(this.spawnNewPipe, this);\r\n        //初始化数组\r\n        this.pipes = [];\r\n\r\n        //取消事件绑定\r\n        cc.eventManager.removeListener(this.bird.touchListener);\r\n\r\n        this.scoreBoard.string = this.score;\r\n        this.moneyScore.string = this.money;\r\n        this.bestScore.string = bestScore;\r\n\r\n        //播放动画事件\r\n        let overAnim = this.overBoard.getComponent(cc.Animation);\r\n        let againAnim = this.againBtn.getComponent(cc.Animation);\r\n        let menuAnim = this.menuBtn.getComponent(cc.Animation);\r\n\r\n        overAnim.play('overBoard');\r\n        againAnim.play('button_move3');\r\n        menuAnim.play('button_move2');\r\n\r\n        //排行榜\r\n        for (let i = 0; i < 5; i++) {\r\n            arr[i] = arr[i] || 0;\r\n            if (this.score > arr[i]) {\r\n                arr.splice(i, 0, this.score);\r\n                if (arr.length > 5) {\r\n                    arr.pop();\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        //本地储存\r\n        cc.sys.localStorage.setItem('money', Math.floor(money));\r\n        cc.sys.localStorage.setItem('arr', arr.toString());\r\n        if (bestScore) {\r\n            //判断当前分数是否大于最高分\r\n            if (bestScore < this.score) {\r\n                //存储\r\n                cc.sys.localStorage.setItem('bestScore', this.score);\r\n            }\r\n        } else {\r\n            cc.sys.localStorage.setItem('bestScore', this.score);\r\n        }\r\n    },\r\n\r\n    update: function (dt) {\r\n\r\n        for (let index = 0; index < this.pipes.length; index++) {\r\n            this.pipes[index].x -= 1;\r\n            //清除元素\r\n            if (this.pipes[index].x < -(this.pipeWidth + this.sceneWidth)) {\r\n                this.node.removeChild(this.pipes[index]);\r\n                this.pipes.shift();\r\n            }\r\n            //判断小鸟是否碰撞到管道上\r\n            if (this.bird.collision) {\r\n                this.over = true;\r\n                this.gameOver();\r\n            }\r\n            //判断小鸟是否穿过管道\r\n            if (this.bird.node.x > this.pipes[index].x && this.pipes[index].mark) {\r\n                this.pipes[index].mark = false;\r\n                this.gainScore();\r\n            }\r\n        }\r\n        //判断小鸟是否超出屏幕以及接触地面\r\n        if ((this.bird.node.y > this.sceneHeight ||\r\n            this.bird.node.y < this.ground.y) &&\r\n            !this.over) {\r\n            this.over = true;\r\n            cc.audioEngine.play(this.dieAudio, false, 1);\r\n            this.gameOver();\r\n        }\r\n    },\r\n    gainScore: function () {\r\n        this.score += 1;\r\n        this.ScoreLabel.string = 'score: ' + this.score.toString();\r\n    }\r\n});\r\n"]}